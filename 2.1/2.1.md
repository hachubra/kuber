# Домашнее задание к занятию «Хранение в K8s. Часть 1»

### Цель задания

В тестовой среде Kubernetes нужно обеспечить обмен файлами между контейнерам пода и доступ к логам ноды.

------

### Чеклист готовности к домашнему заданию

1. Установленное K8s-решение (например, MicroK8S).
2. Установленный локальный kubectl.
3. Редактор YAML-файлов с подключенным GitHub-репозиторием.

------

### Дополнительные материалы для выполнения задания

1. [Инструкция по установке MicroK8S](https://microk8s.io/docs/getting-started).
2. [Описание Volumes](https://kubernetes.io/docs/concepts/storage/volumes/).
3. [Описание Multitool](https://github.com/wbitt/Network-MultiTool).

------

### Задание 1 

**Что нужно сделать**

Создать Deployment приложения, состоящего из двух контейнеров и обменивающихся данными.

1. Создать Deployment приложения, состоящего из контейнеров busybox и multitool.
2. Сделать так, чтобы busybox писал каждые пять секунд в некий файл в общей директории.
3. Обеспечить возможность чтения файла контейнером multitool.
4. Продемонстрировать, что multitool может читать файл, который периодически обновляется.
5. Предоставить манифесты Deployment в решении, а также скриншоты или вывод команды из п. 4.

#### Решение 1.

Deployment:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: busy-multi
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: busy-multi
  template:
    metadata:
      labels:
        app: busy-multi
    spec:
      containers:
      - name: busybox
        image: busybox
        command: ["/bin/sh", "-c"]
        args: ["date >> /output/file.txt; sleep 5"] 
        volumeMounts:
        - name: vol1
          mountPath: /output
      - name: wbitt
        image: wbitt/network-multitool
        env:
        - name: HTTP_PORT
          value: "8080"
        - name: HTTPS_PORT  
          value: "8443"
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: vol1
          mountPath: /input
      volumes: 
      - name: vol1  
        emptyDir: {}

```
Проверка работы: 

```bash
alex@ubu04:~/kuber2025/2.1$ kubectl exec -it deployments/busy-multi -c wbitt -- bash
```

```bash
busy-multi-dddcf587b-n6ss4:/# cat /input/file.txt 
Sun Jul 27 16:48:25 UTC 2025
Sun Jul 27 16:48:32 UTC 2025
Sun Jul 27 16:48:51 UTC 2025
Sun Jul 27 16:49:26 UTC 2025
```

------

### Задание 2

**Что нужно сделать**

Создать DaemonSet приложения, которое может прочитать логи ноды.

1. Создать DaemonSet приложения, состоящего из multitool.
2. Обеспечить возможность чтения файла `/var/log/syslog` кластера MicroK8S.
3. Продемонстрировать возможность чтения файла изнутри пода.
4. Предоставить манифесты Deployment, а также скриншоты или вывод команды из п. 2.

#### Решение 2.
Daemonset: 

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: multi
  labels:
    app: multi
spec:
  selector:
    matchLabels:
      app: multi
  template:
    metadata:
      labels:
        app: multi
    spec:
      containers:
      - name: wbitt
        image: wbitt/network-multitool
        env:
        - name: HTTP_PORT
          value: "8080"
        - name: HTTPS_PORT 
          value: "8443"
        ports:
        - containerPort: 8080
        volumeMounts:
        - name: vol1
          mountPath: /input
      volumes: 
      - name: vol1  
        hostPath: 
          path: /var/log

```
Проврека работы:

```bash
kubectl apply -f daemonset1.yaml 
```

```bash
kubectl exec daemonsets/multi -it -- bash
```

```bash
alex@ubu04:~/kuber2025/2.1$ kubectl get po
NAME          READY   STATUS    RESTARTS   AGE
multi-xzdkp   1/1     Running   0          3m26s
```

```bash
alex@ubu04:~/kuber2025/2.1$ kubectl exec daemonsets/multi -it -- bash
multi-xzdkp:/# 
```

```bash
multi-xzdkp:/# tail -n 5 /input/syslog
Jul 27 22:02:32 ubu04 gnome-shell[6045]: (EE) 16: /usr/bin/Xwayland (0x5a830b969000+0x34ae3) [0x5a830b99dae3]
Jul 27 22:02:32 ubu04 gnome-shell[6045]: (EE) 17: /lib/x86_64-linux-gnu/libc.so.6 (0x762340e00000+0x29d90) [0x762340e29d90]
Jul 27 22:02:32 ubu04 gnome-shell[6045]: (EE) 18: /lib/x86_64-linux-gnu/libc.so.6 (__libc_start_main+0x80) [0x762340e29e40]
Jul 27 22:02:32 ubu04 gnome-shell[6045]: (EE) 19: /usr/bin/Xwayland (0x5a830b969000+0x36305) [0x5a830b99f305]
Jul 27 22:02:32 ubu04 gnome-shell[6045]: (EE)
multi-xzdkp:/# 
```


------

### Правила приёма работы

1. Домашняя работа оформляется в своём Git-репозитории в файле README.md. Выполненное задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

------
