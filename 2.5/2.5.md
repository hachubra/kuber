# Домашнее задание к занятию «Helm»

### Цель задания

В тестовой среде Kubernetes необходимо установить и обновить приложения с помощью Helm.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение, например, MicroK8S.
2. Установленный локальный kubectl.
3. Установленный локальный Helm.
4. Редактор YAML-файлов с подключенным репозиторием GitHub.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция](https://helm.sh/docs/intro/install/) по установке Helm. [Helm completion](https://helm.sh/docs/helm/helm_completion/).

------

### Задание 1. Подготовить Helm-чарт для приложения

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. Каждый компонент приложения деплоится отдельным deployment’ом или statefulset’ом.
3. В переменных чарта измените образ приложения для изменения версии.

#### Решение 1. 

Подготовка. Установка HELM:

```bash
curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null
sudo apt-get install apt-transport-https --yes
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
sudo apt-get update
sudo apt-get install helm
```

```bash
helm create neto-chart
```

deployment:
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ .Release.Name }}
  namespace: {{ .Release.Namespace }}
  labels:
    app: nginx
spec:
  replicas: {{ .Values.replicas }}
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: {{ .Values.container.name }}
        image: {{ .Values.image.name }}:{{ .Values.image.tag }}
        ports:
        - containerPort: 80
```

service:

```yaml
{{ if .Values.service.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Release.Name }}-nginx-svc
  namespace: {{ .Release.Namespace }}
spec:
  type: ClusterIP
  ports:
  - name: nginx
    port: 9001
    protocol: TCP
    targetPort: 80
  selector:
    app: nginx
{{ end }}
```

values:

```yaml
container: 
  name: nginx
image:
  name: nginx
  tag: latest
replicas: 3
service:
  enabled: true
```
------
### Задание 2. Запустить две версии в разных неймспейсах

1. Подготовив чарт, необходимо его проверить. Запуститe несколько копий приложения.
2. Одну версию в namespace=app1, вторую версию в том же неймспейсе, третью версию в namespace=app2.
3. Продемонстрируйте результат.


#### Решение 2.

Запуск первой копии приложения в namespace=app1:

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ helm install first . --namespace app1 --create-namespace
NAME: first
LAST DEPLOYED: Sun Aug 17 23:25:46 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
TEST SUITE: None
```

Запуск второй копии приложения namespace=app1:

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ helm install second . --namespace app1 --create-namespace
NAME: second
LAST DEPLOYED: Sun Aug 17 23:26:23 2025
NAMESPACE: app1
STATUS: deployed
REVISION: 1
TEST SUITE: None
```

Запуск третей копии приложения namespace=app2:

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ helm install third . --namespace app2 --create-namespace
NAME: third
LAST DEPLOYED: Sun Aug 17 23:27:23 2025
NAMESPACE: app2
STATUS: deployed
REVISION: 1
TEST SUITE: None
```

Демонстрация результата:

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ helm list --namespace=app1
NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
first   app1            1               2025-08-17 23:25:46.652175812 +0500 +05 deployed        neto-chart-0.1.0        1.16.0     
second  app1            1               2025-08-17 23:26:23.475102961 +0500 +05 deployed        neto-chart-0.1.0        1.16.0  
```

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ helm list --namespace=app2
NAME    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
third   app2            1               2025-08-17 23:27:23.066248038 +0500 +05 deployed        neto-chart-0.1.0        1.16.0   
```

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ kubectl get svc --namespace=app1
NAME               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
first-nginx-svc    ClusterIP   10.152.183.49   <none>        9001/TCP   2m26s
second-nginx-svc   ClusterIP   10.152.183.33   <none>        9001/TCP   110s
```

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ kubectl get po --namespace=app1
NAME                    READY   STATUS    RESTARTS   AGE
first-96b9d695-ld5kn    1/1     Running   0          2m9s
first-96b9d695-ls9mj    1/1     Running   0          2m9s
first-96b9d695-sqq6c    1/1     Running   0          2m9s
second-96b9d695-chwb5   1/1     Running   0          93s
second-96b9d695-w5f4g   1/1     Running   0          93s
second-96b9d695-zvcph   1/1     Running   0          93s
```

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ kubectl get svc --namespace=app2
NAME              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
third-nginx-svc   ClusterIP   10.152.183.126   <none>        9001/TCP   68s
```

```bash
alex@ubu04:~/kuber2025/2.5/neto-chart$ kubectl get po --namespace=app2
NAME                   READY   STATUS    RESTARTS   AGE
third-96b9d695-h9wjv   1/1     Running   0          61s
third-96b9d695-kfknp   1/1     Running   0          61s
third-96b9d695-tb5hh   1/1     Running   0          61s
```


### Правила приёма работы

1. Домашняя работа оформляется в своём Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, `helm`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

